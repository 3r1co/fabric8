<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Continuous Delivery of Microservices with Kubernetes</title>

  <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
  <meta name="author" content="Hakim El Hattab">

  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <link rel="stylesheet" href="css/reveal.min.css">
  <link rel="stylesheet" href="css/theme/simple.css" id="theme">
  <!--
      <link rel="stylesheet" href="css/theme/default.css" id="theme">
  -->

  <!-- For syntax highlighting -->
  <link rel="stylesheet" href="lib/css/zenburn.css">

  <style>
.reveal section img {
  border: 0px;
  box-shadow: 0 0 0px;
}
  </style>


  <!-- If the query includes 'print-pdf', use the PDF print sheet -->
  <script>
    document.write('<link rel="stylesheet" href="css/print/' + ( window.location.search.match(/print-pdf/gi) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">');
  </script>

  <!--[if lt IE 9]>
  <script src="lib/js/html5shiv.js"></script>
  <![endif]-->
</head>

<body>

<div class="reveal">

<!-- Any section element inside of this container is displayed as a slide -->
<div class="slides">
<section>
  <h2>Continuous Delivery of </h2>

  <h2>Microservices with Kubernetes</h2>

  <p>
    <small><a href="http://macstrac.blogspot.co.uk/">James Strachan</a> / <a
            href="http://twitter.com/jstrachan">@jstrachan</a> from <a href="http://redhat.com/">Red Hat</a></small>
  </p>
</section>


<section>
  <h2>How can we deliver business value faster?</h2>
  <p>despite increasing complexity, platforms, devices, SaaS, social media, IoC, integrations, capabilities, scale and data centres?</p>
</section>

<section>
  <h2>Microservices / DevOps</h2>
  <ul>
    <li class="fragment">
      refactor monolith into separate services
      <ul>
        <li>each microservice has its own release cycle</li>
        <li>smaller independent releases</li>
      </ul>
      </li>
    <li class="fragment">
      refactor team into separate teams
      <ul>
        <li>one team of Dev + Testing + Ops per microservice</li>
        <li>2 pizza rule rather than Mythical Man month</li>
      </ul>
    </li>
    <li class="fragment">
      automate everything
      <ul>
        <li>immutable infrastructure</li>
        <li>Continous Integration / Delivery / Deployment / Improvement</li>
      </ul>
    </li>
    <li class="fragment">
      iterate faster and win!
      <ul>
        <li>scale teams and software through federation</li>
        <li>reduce complexity per microservice so you can go faster</li>
      </ul>
    </li>
  </ul>
</section>

<section>
  <h2>Needs for Speed!</h2>
  <ul>
    <li>
      self service platform for Microservice teams that supports:
      <ul>
        <li>packaging software + configuration into immutable distros</li>
        <li>easily move versions forward/back in different environments (CI/CD)</li>
        <li>service discovery / auto scaling / failover</li>
        <li>on premise, public or hybrid cloud</li>
      </ul>
    </li>
  </ul>
</section>



<section>
  <h2>Docker</h2>
  <p>
    package your micro service into a shipping container
  </p>
  <div align="centre">
    <img src="images/docker.png">
  </div>
  <p>
    <a href="https://www.docker.com/">https://www.docker.com/</a>
  </p>
</section>

<section>
  <h2>Docker</h2>
  <ul>
    <li>
      packaging for a linux process
      <ul>
        <li>immutable images</li>
        <li>run everywhere</li>
        <li>images are small and easy to cache</li>
      </ul>
    </li>
    <li class="fragment">
      isolate processes
      <ul>
        <li>each container has its own file system and ports</li>
        <ul>
          <li>avoids conflicts between containers</li>
        </ul>
        <li>set limits: IO, CPU, memory, ...</li>
        <ul>
          <li>helps pack containers onto hosts</li>
        </ul>
        <li>run 1000s of containers per node rather than 10s of VMs</li>
      </ul>
    </li>
  </ul>
</section>

<section>
  <h2>Docker</h2>
  <div align="centre">
    <code>docker run -itP myuser/myservice</code>
  </div>
</section>

<section>
  <div align="centre">
    <img src="images/kube-hot.jpg" height="800" >
  </div>
</section>

<section>
  <h2>Kubernetes</h2>
<p>
  orchestrate your containers!
</p>
<div align="centre">
  <img src="images/kubernetes.svg" height="500" width="800">
</div>
  <p>
    <a href="https://kubernetes.io/">https://kubernetes.io/</a>
  </p>
</section>


<section>
  <h2>Project Atomic</h2>
<p>
  micro service based Linux
</p>
<div align="centre">
  <img src="images/atomic.svg" height="500" width="500">
</div>
<p>
  <a href="http://www.projectatomic.io/">projectatomic.io</a>
</p>
<p>
  RHEL Atomic is the product
</p>
</section>

<section>
  <h2>OpenShift V3</h2>
<p>
  docker / kubernetes based PaaS
</p>
<p>
<div align="centre">
  <img src="images/openshift.png" height="500" width="500">
</div>
<a href="https://openshift.github.io/">openshift.github.io</a>
</p>
</section>

<section>
  <h2>OpenShift</h2>
  <div align="centre">
    <code>
oc run someName
      --image=myuser/myservice
      --replicas=5
    </code>
  </div>
</section>

<section>
  <h2>Kubernetes Overview</h2>
<div align="centre">
  <img src="images/kubernetes-overview.png" height="500" width="500">
</div>
  <p>
    <a href="https://kubernetes.io/">https://kubernetes.io/</a>
  </p>
</section>

<section>
  <h2>Kubernetes: sub atomic particles</h2>
  <p>
    <ul>
      <li>Pods</li>
      <li>Replication Controllers</li>
      <li>Services</li>
    </ul>
  </p>
</section>

<section>
  <h2>Pod</h2>
  <p>
    <ul>
      <li>for a Java person, just think a JVM with: </li>
      <ul>
        <li>environment variables</li>
        <li>ports</li>
        <li>volumes</li>
      </ul>
      <li>each Pod has its own unique IP address</li>
    </ul>
  </p>
</section>

<section>
  <pre class="stretch"><code data-trim>
apiVersion: "v1"
kind: "ReplicationController"
metadata:
  name: "elasticsearch"
spec:
  replicas: 1
  selector:
    component: "elasticsearch"
    provider: "fabric8"
  template:
    metadata:
      labels:
        component: "elasticsearch"
        provider: "fabric8"
    spec:
      containers:
        -
          name: "elasticsearch"
          image: "fabric8/elasticsearch-k8s:1.5.2"
          env:
            -
              name: "SERVICE_DNS"
              value: "elasticsearch-cluster"
          ports:
            -
              containerPort: 9200
              name: "http"
</code></pre>
<p>Replication Controller</p>
</section>

<section>
  <h2>Service</h2>
  <ul>
    <li>each service has its own unique IP address</li>
  </ul>
  <pre><code data-trim>
apiVersion: "v1"
kind: "Service"
metadata:
  name: "elasticsearch"
  labels:
    component: "elasticsearch"
    provider: "fabric8"
spec:
  ports:
    -
      port: 80
      targetPort: 9200
  selector:
    component: "elasticsearch"
    provider: "fabric8"
</code></pre>
</section>

<section>
  <h2>Service</h2>
  <ul>
    <li>services can be implemented:
      <ul>
        <li>internally using <b>pod selectors</b></li>
        <li>externally or aliased by creating <b>Endpoints</b></li>
      </ul>
    </li>
    <li>services are visible internally and can be exposed externally</li>
      <ul>
        <li>GKE: &nbsp;&nbsp;<code>type: LoadBalancer</code></li>
        <li>OpenShift: &nbsp;<code>oc expose service foo</code></li>
      </ul>
    </li>
  </ul>
</section>

<section>
  <h2>Service Discovery</h2>
  <p>
    for a service called <b>foo-bar</b> here is how you discover to it:
    <ul>
      <li>http://foo-bar/</li>
      <li>https://foo-bar/</li>
    </ul>
  </p>
  <p>
    Works nicely for different namespaces / environments without code or config change!
  </p>
  <p>
    DNS FTW!
  </p>
</section>

<section>
  <h2>Kubernetes: other useful resources</h2>
  <p>
  <ul>
    <li>Secrets</li>
    <li>Service Accounts</li>
    <li>Persistent Volumes</li>
    <li>Config Maps (new!)</li>
  </ul>
  </p>
</section>

<section>
  <h2>Tools</h2>
  <ul>
    <li>kubectl get pods</li>
    <li>kubectl delete pod foo-abc234</li>
    <li>kubectl create -f foo.json</li>
  </ul>
</section>

<section>
  <h2>Kubernetes: sub atomic particles</h2>
  <p>
    <ul>
      <li>Pods</li>
      <li>Replication Controllers</li>
      <li>Services</li>
    </ul>
  </p>
</section>

<section>
  <h2>Microservice on Kubernetes?</h2>
  <p>
    each microservice typically has:
    <ul>
      <li>Replication Controller</li>
      <li>Service</li>
    </ul>
  </p>
</section>

<section>
  <h2>Develop microservices on Kubernetes</h2>
  <p>
    <ul>
      <li>Write some code</li>
      <li>Put code into docker image</li>
      <li>Create kubernetes manifest YAML/JSON</li>
      <li>Apply the manifest to an environment</li>
      <li>Resize and rolling upgrades</li>
      <li>CI / CD can automate the above ;)</li>
    </ul>
  </p>
</section>

<section>
  <h2>Fabric8</h2>
  <p>
    <a href="https://fabric8.io/">https://fabric8.io/</a>
  </p>
  <div align="centre">
    <img src="images/fabric8.svg" height="500" width="500">
  </div>
</section>


<section>
  <h2>What is Fabric8?</h2>
  <p>
    <ul>
      <li>Microservices that run on Kubernetes
        <ul>
          <li>Management: (Console, Logging, Metrics)</li>
          <li>Continuous Delivery</li>
          <li>iPaaS</li>
        </ul>
      </li>
      <li>Tools for Java developers</li>
    </ul>
  </p>
</section>


<section>
  <h2>Continous Delivery</h2>
  <p>
  <ul>
    <li><i>Continuous Delivery</i> is based around <b>pipelines</b>
      <ul>
        <li>Build an image and kubernetes manifest once</li>
        <li>Run integration, system, soak tests</li>
        <li>Promote the build to different <b>Environments</b> (Dev, Test, UAT, Staging, Prod)</li>
        <li>Human approval at key stages</li>
        <li>Sequential, Parallel, Fork/Join of steps along with state sharing (e.g. version numbers)</li>
      </ul>
    </li>
  </ul>
  </p>
</section>

<section>
  <h2>Fabric8 Continous Delivery</h2>
  <p>
  <ul>
    <li><b>Jenkins Pipeline</b> is the pipeline implementation:
      <ul>
        <li>orchestrator of build, test, promote, approve <i>steps</i></li>
        <li>old name is <i>Jenkins Workflow plugin</i></li>
      </ul>
    </li>
    <li>A <b>Jenkinsfile</b>
      <ul>
        <li>a Groovy DSL for defining the pipeline steps, pods, docker images, secrets</li>
        <li>maps to a single Jenkins job with minimal configuration</li>
        <li>Label parts of the pipeline with <i>stages</i> to simplify pipeline progress visualisation</li>
        <li>Pipeline as code!</li>
      </ul>
    </li>
  </ul>
  </p>
</section>

<section>
  <h2>Fabric8 CD: Jenkinsfile</h2>
  <p>
  <ul>
    <li>Each project copies a <b>Jenkinsfile</b> into their project source code; or points at a shared Jenkinsfile
    </li>
    <li>Reusable library of Pipeline flows:
      <ul>
        <li>lets you share Jenkinsfiles between projects to bootstrap projects faster</li>
        <li>reusable library of common build steps available as DSL extensions and reusable functions</li>
        <li>over time you can refactor your Jenkinsfiles to share common steps</li>
      </ul>
    </li>
  </ul>
  </p>
</section>

<section>
  <h2>Jenkins Pipeline Extensions</h2>
  <p>
  <ul>
    <li><b>Docker Pipeline</b> plugin works for <b>stand alone docker</b> only! So you should really use Kubernetes Pipeline...</li>
    <li><b>Kubernetes Pipeline</b> plugin adds Kubernetes semantics
      <ul>
        <li>Define pods on demand for step/tool execution (maven/nodejs etc)</li>
        <li>Mount secrets and persistent volumes etc</li>
        <li>See the <a href="https://blog.fabric8.io/a-kubernetes-workflow-plugin-for-jenkins-b62110be03dc#.hacpl7ylg">kubernetes-workflow documentation</a></li>
      </ul>
    </li>
    <li><b>OpenShift Pipeline</b> plugin adds OpenShift semantics
      <ul>
        <li>lets you reuse OpenShift S2I builds, ImageStreams, tag/promote images etc</li>
      </ul>
    </li>
  </ul>
  </p>
</section>

<section>
  <h2>Fabric8 Continous Delivery: Example</h2>
  <div align="centre">
    <img src="images/sample-jenkinsfile.png" height="650" width="1600">
  </div>
</section>

<section>
  <h2>Fabric8 Console: Visualise CD!</h2>
  <div align="centre">
    <img src="images/project-overview.png" height="650" width="1600">
  </div>
</section>


<section>
  <h2>Fabric8: Java Tools</h2>
  <p>
    <ul>
      <li>Maven plugin</li>
      <li>Java Libraries for working with Kubernetes</li>
      <li>Integration Testing
        <ul>
          <li>Arquillian plugin for JUnit</li>
        </ul>
      </li>
    </ul>
  </p>
</section>


<section>
  <h2>Fabric8: Maven Plugin</h2>
<p>
  build docker image:
</p>
<div align="left">
<pre>
<code>
$  mvn docker:build

</code>
</pre>
</div>
<p>
  generate kubernetes json:
</p>
<div align="left">
<pre>
<code>
$  mvn fabric8:json

</code>
</pre>
</div>
  <p>
    apply kubernetes json and image to kubernetes:
  </p>
<div align="left">
<pre>
<code>
$  mvn fabric8:apply

</code>
</pre>
</div>
</section>

<section>
  <h2>Integration Testing</h2>
<div align="centre">
  <img src="images/arqtest.png" height="650" width="1200">
</div>
  <p>
    <a href="http://fabric8.io/guide/testing.html">http://fabric8.io/guide/testing.html</a>
  </p>
</section>


<section>
  <h2>Any questions?</h2>
  <table>
    <tr>
      <td>
        <a href="http://fabric8.io/guide/getStarted/vagrant.html">fabric8 vagrant</a>
      </td>
      <td>
        install a Vagrant VM with Kubernetes!
      </td>
    </tr>
    <tr>
      <td>
        <a href="https://kubernetes.io/">kubernetes.io</a>
      </td>
      <td>
        orchestrate your containers
      </td>
    </tr>
    <tr>
      <td>
        <a href="https://www.docker.com/">docker.com</a>
      </td>
      <td>
        create container images for kubernetes
      </td>
    </tr>
    <tr>
      <td>
        <a href="https://openshift.github.io/">openshift.github.io</a>
      </td>
      <td>
        kubernetes based PaaS
      </td>
    </tr>
    <tr>
      <td>
        <a href="http://fabric8.io/">fabric8.io</a>
      </td>
      <td>
        CD and DevOps tools for kubernetes
      </td>
    </tr>
  </table>

  <!--
  <li>
    <a href="http://hawt.io/">http://hawt.io/</a>
  </li>
-->

  <div align="center">
    <a href="http://twitter.com/jstrachan">@jstrachan</a>
  </div>

</section>

</div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.min.js"></script>

<script>

  // Full list of configuration options available here:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: true,

    theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
    //transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none
    transition: 'linear',

    // Parallax scrolling
    // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
    // parallaxBackgroundSize: '2100px 900px',

    // Optional libraries used to extend on reveal.js
    dependencies: [
      { src: 'lib/js/classList.js', condition: function () {
        return !document.body.classList;
      } },
      { src: 'plugin/markdown/marked.js', condition: function () {
        return !!document.querySelector('[data-markdown]');
      } },
      { src: 'plugin/markdown/markdown.js', condition: function () {
        return !!document.querySelector('[data-markdown]');
      } },
      { src: 'plugin/highlight/highlight.js', async: true, callback: function () {
        hljs.initHighlightingOnLoad();
      } },
      { src: 'plugin/zoom-js/zoom.js', async: true, condition: function () {
        return !!document.body.classList;
      } },
      { src: 'plugin/notes/notes.js', async: true, condition: function () {
        return !!document.body.classList;
      } }
    ]
  });

</script>

</body>
</html>
